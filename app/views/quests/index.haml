%script{:src => "//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry", :type => "text/javascript"}
%script{:src => "//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js", :type => "text/javascript"}

.row
  .col-lg-3.col-md-3.col-xs-3.sidebar
    = render "shared/sidebar"
  .col-lg-9.col-md-9.col-xs-9.central
    .tabpanel
      %ul.nav.nav-tabs{ role: "tablist" }
        %li.active{ role: "presentation" }
          %a{ href: "#map", aria: { controls: "map" }, role: "tab", data: { toggle: "tab" } } Quest Map
        %li{ role: "presentation" }
          %a{ href: "#list", aria: { controls: "list" }, role: "tab", data: { toggle: "tab" } } Quest List


      .tab-content
        .tab-pane.active.quests#map{ role: "tabpanel" }
          #map-canvas
        .tab-pane.quests#list{ role: "tabpanel" }
          %h3 Accepted Quests
          = render "quests/missions", missions: @accepted_quests
          %hr
          %h3 Available Quests
          = render "quests/quests", quests: @available_quests

:javascript
  $(function(){
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {
          handler = Gmaps.build("Google");
          handler.buildMap({ provider: { Zoom: 15, center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude)}, internal: {id: 'map-canvas'}}, function(){
            markers = handler.addMarkers(#{raw @quests.to_json})
            handler.bounds.extendWith(markers);
          })
        }
      ) 
    } else {

    }

    RigPirate.Tooltip.init()
  })
